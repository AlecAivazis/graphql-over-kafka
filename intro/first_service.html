

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Your First Service &mdash; nautilus v0.5.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="nautilus v0.5.1 documentation" href="../index.html"/>
        <link rel="up" title="Getting Started" href="index.html"/>
        <link rel="next" title="Keeping Track of Data" href="first_model.html"/>
        <link rel="prev" title="Installation / Setup" href="installation.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> nautilus
          

          
          </a>

          
            
            
              <div class="version">
                v0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation / Setup</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Your First Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#responding-to-actions">Responding to Actions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="first_model.html">Keeping Track of Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="connecting_services.html">Connecting Services Together</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">Querying The Distributed Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="auth.html">Authentication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/index.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../handlers/index.html">Action Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internals/index.html">Module Index</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">nautilus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Getting Started</a> &raquo;</li>
      
    <li>Your First Service</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/intro/first_service.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="your-first-service">
<h1>Your First Service<a class="headerlink" href="#your-first-service" title="Permalink to this headline">¶</a></h1>
<p>Services are the fundamental building blocks for cloud applications powered by
nautilus. Let&#8217;s begin by creating a directory with an empty file somewhere on
your computer for us to use as a playground.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mkdir nautilus_playground <span class="o">&amp;&amp;</span> <span class="se">\</span>
        <span class="nb">cd</span> nautilus_playground <span class="o">&amp;&amp;</span> <span class="se">\</span>
        touch server.py
</pre></div>
</div>
<p>Now that we have a file, let&#8217;s make our first service. Keep in mind, that
this section is meant to illustrate the various parts of a service, as you
will see in the next section, the service we are about to construct can be
much more succintly created using one of nautilus&#8217;s pre-packaged services.
Open server.py in your favorite text editor and copy and paste the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nautilus</span> <span class="kn">import</span> <span class="n">Service</span>

<span class="k">class</span> <span class="nc">RecipeService</span><span class="p">(</span><span class="n">Service</span><span class="p">):</span> <span class="k">pass</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># create an instance of the service</span>
    <span class="n">service</span> <span class="o">=</span> <span class="n">RecipeService</span><span class="p">()</span>

    <span class="c1"># create a manager for the service</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">ServiceManager</span><span class="p">(</span><span class="n">RecipeService</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Test that this works by executing this script in your console:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ python3 ./server.py runserver
</pre></div>
</div>
<p>If it complains about permissions, try running <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">chmod</span> <span class="pre">u+x</span> <span class="pre">./server.py</span></code>.</p>
<p>Right now, our service is nothing more than a python process. It doesn&#8217;t react
to the outside world, it doesn&#8217;t store any data, nor does it provide
anything for another service to use - let&#8217;s change that.</p>
<div class="section" id="responding-to-actions">
<h2>Responding to Actions<a class="headerlink" href="#responding-to-actions" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a service, we can start adding some functionality to it. In the
nautilus architecture, services are triggered to perform certain actions by
events. We describe how the service responds to those events through
the <code class="docutils literal"><span class="pre">Action</span> <span class="pre">Handler</span></code>, a class record that holds the event configuration
as well as its behavior:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nautilus.network</span> <span class="kn">import</span> <span class="n">ActionHandler</span>

<span class="k">class</span> <span class="nc">PrintHandler</span><span class="p">(</span><span class="n">ActionHandler</span><span class="p">):</span>

    <span class="n">async</span> <span class="k">def</span> <span class="nf">handle_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;hello world!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The primary method of an ActionHandler takes three arguments: <code class="docutils literal"><span class="pre">action_type</span></code>,
<code class="docutils literal"><span class="pre">payload</span></code>, and <code class="docutils literal"><span class="pre">props</span></code>. <code class="docutils literal"><span class="pre">Action_type</span></code> identifies the event and
<code class="docutils literal"><span class="pre">payload</span></code> provides the associated data. Ignore <code class="docutils literal"><span class="pre">props</span></code> for now. Let&#8217;s test
your service using the command line interface provided by nautilus. Open up a
new terminal and execute:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ naut publish -p <span class="s2">&quot;hello world&quot;</span>
</pre></div>
</div>
<p>You should see the message in your running service&#8217;s console. This pattern
can be made to acommodate almost any situation. For example, if you had
some special behavior that you wanted your service to do (like send an email),
you would triger that behavior by firing a &#8220;send_email&#8221; action type and
responding appropriately:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nautilus.network</span> <span class="kn">import</span> <span class="n">ActionHandler</span>

<span class="k">class</span> <span class="nc">EmailActionHandler</span><span class="p">(</span><span class="n">ActionHandler</span><span class="p">):</span>

    <span class="n">async</span> <span class="k">def</span> <span class="nf">handle_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s1">&#39;send_email&#39;</span><span class="p">:</span>
            <span class="c1"># send the body of the action as the email</span>
            <span class="n">send_email</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</pre></div>
</div>
<p>Passing the Action handler to the service takes a single line:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nautilus</span> <span class="kn">import</span> <span class="n">Service</span><span class="p">,</span> <span class="n">ServiceManager</span>
<span class="kn">from</span> <span class="nn">nautilus.network</span> <span class="kn">import</span> <span class="n">ActionHandler</span>


<span class="k">class</span> <span class="nc">PrintHandler</span><span class="p">(</span><span class="n">ActionHandler</span><span class="p">):</span>

    <span class="n">async</span> <span class="k">def</span> <span class="nf">handle_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">action_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyService</span><span class="p">(</span><span class="n">Service</span><span class="p">):</span>
    <span class="n">action_handler</span> <span class="o">=</span> <span class="n">PrintHandler</span>


<span class="n">manager</span> <span class="o">=</span> <span class="n">ServiceManager</span><span class="p">(</span><span class="n">RecipeService</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">manager</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Congratulations! You have finally pieced together a complete nautilus service.
In the next section you will learn how to create services that
manage and persist database entries for your application.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="first_model.html" class="btn btn-neutral float-right" title="Keeping Track of Data" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral" title="Installation / Setup" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Alec Aivazis.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'v0.5.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>