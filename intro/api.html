

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Querying The Distributed Structure &mdash; nautilus v0.5.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="nautilus v0.5.1 documentation" href="../index.html"/>
        <link rel="up" title="Getting Started" href="index.html"/>
        <link rel="next" title="Authentication" href="auth.html"/>
        <link rel="prev" title="Connecting Services Together" href="connecting_services.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> nautilus
          

          
          </a>

          
            
            
              <div class="version">
                v0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation / Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_service.html">Your First Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_model.html">Keeping Track of Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="connecting_services.html">Connecting Services Together</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Querying The Distributed Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="auth.html">Authentication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/index.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../handlers/index.html">Action Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internals/index.html">Module Index</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">nautilus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Getting Started</a> &raquo;</li>
      
    <li>Querying The Distributed Structure</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/intro/api.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="querying-the-distributed-structure">
<h1>Querying The Distributed Structure<a class="headerlink" href="#querying-the-distributed-structure" title="Permalink to this headline">Â¶</a></h1>
<p>We now have three different services which are each responsible for maintaining
a small bit of the application. While this has many benefits, one rather large
annoyance is the difficulty to create a summary of our application using data
that spans many services.</p>
<p>One way to solve this is to create a service known as an &#8220;API gateway&#8221; which,
unlike the services we have encountered so far, does not maintain any sort of
internal state. Instead, this service just has a single schema that describes
the entire cloud. This has a few major benefits that are worth pointing out:</p>
<ul class="simple">
<li>The distributed nature of the cloud is completely hidden behind a single endpoint</li>
<li>Authorization is maintained by a single service</li>
<li>Various network optimizations only need to occur in a single place</li>
<li>The list of external mutations is in one place</li>
</ul>
<p>Let&#8217;s begin by creating a new file called <code class="docutils literal"><span class="pre">api.py</span></code> in our directory with the
following contents:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># external imports</span>
<span class="kn">from</span> <span class="nn">nautilus</span> <span class="kn">import</span> <span class="n">APIGateway</span><span class="p">,</span> <span class="n">ServiceManager</span>

<span class="k">class</span> <span class="nc">CatPhotoAPI</span><span class="p">(</span><span class="n">APIGateway</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">manager</span> <span class="o">=</span> <span class="n">ServiceManager</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">manager</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>When this service runs it sends an event that intstructs all other services to announce
their api contributitions. This information is pieced together to form a single api endpoint
that is used to query the entire system. With your CatPhoto service running, start up the api
passing a different port:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python3 api.py runserver --port 8001
</pre></div>
</div>
<p>And visit the <cite>/graphiql</cite> endpoint like before. You should be able to see your other services
as queryable nodes in the api as well as some mutations to handle the internal
state of our model services.</p>
<p>Out of the box, nautilus provides a few filters for graphql nodes based on ModelServices, for
more information visit the <a class="reference external" href="../api/index.html#filtering-the-api">APIGateway Documentation</a>.</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="auth.html" class="btn btn-neutral float-right" title="Authentication" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="connecting_services.html" class="btn btn-neutral" title="Connecting Services Together" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Alec Aivazis.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'v0.5.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>