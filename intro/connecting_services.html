

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Connecting Services Together &mdash; nautilus v0.3.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="nautilus v0.3.0 documentation" href="../index.html"/>
        <link rel="up" title="Getting Started" href="index.html"/>
        <link rel="next" title="Querying The Distributed Structure" href="api.html"/>
        <link rel="prev" title="Your First Service" href="first_service.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> nautilus
          

          
          </a>

          
            
            
              <div class="version">
                v0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation / Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_service.html">Your First Service</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Connecting Services Together</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-pre-defined-services">Using Pre-defined Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connection-models">Connection Models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html">Querying The Distributed Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="auth.html">Authentication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../handlers/index.html">Action Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schema/index.html">Service API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internals/index.html">Module Index</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">nautilus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Getting Started</a> &raquo;</li>
      
    <li>Connecting Services Together</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/intro/connecting_services.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="connecting-services-together">
<h1>Connecting Services Together<a class="headerlink" href="#connecting-services-together" title="Permalink to this headline">¶</a></h1>
<p>Given their highly specialized nature, a service is not very useful on its
own. So, let&#8217;s add another to our example cloud. This is a good opportunity
to use some of the services that nautilus provides which are great starting
points when adding new functionalities to your cloud.</p>
<div class="section" id="using-pre-defined-services">
<h2>Using Pre-defined Services<a class="headerlink" href="#using-pre-defined-services" title="Permalink to this headline">¶</a></h2>
<p>One of the most commonly used services is the ModelService which maintains
records of a particular database. If this sounds really familiar, it should
- you implemented 80% of the service in Part 1, it just handles the other
CRUD actions for you.</p>
<p>Before we add another model service, let&#8217;s rename the <code class="docutils literal"><span class="pre">server.py</span></code> file
from part 1 to <code class="docutils literal"><span class="pre">recipes.py</span></code> and create a new file called <code class="docutils literal"><span class="pre">ingredients.py</span></code>
in our directory. Inside of this file, paste the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># third party imports</span>
<span class="kn">from</span> <span class="nn">nautilus</span> <span class="kn">import</span> <span class="n">ModelService</span><span class="p">,</span> <span class="n">ServiceManager</span>
<span class="c1"># third party imports</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Text</span>
<span class="kn">from</span> <span class="nn">nautilus.models</span> <span class="kn">import</span> <span class="n">HasID</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">CRUDNotificationCreator</span>

<span class="c1"># the notification mixin adds the sqlalchemy event handlers from part 1</span>
<span class="k">class</span> <span class="nc">Ingredient</span><span class="p">(</span><span class="n">CRUDNotificationCreator</span><span class="p">,</span> <span class="n">HasID</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ServiceConfig</span><span class="p">:</span>
    <span class="n">SQLALCHEMY_DATABASE_URI</span> <span class="o">=</span> <span class="s1">&#39;sqlite:////tmp/ingredients.db&#39;</span>


<span class="n">service</span> <span class="o">=</span> <span class="n">ModelService</span><span class="p">(</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Ingredient</span><span class="p">,</span>
    <span class="n">configObject</span> <span class="o">=</span> <span class="n">ServiceConfig</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">manager</span> <span class="o">=</span> <span class="n">ServiceManager</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">manager</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>You can see that we were able to get the same/more functionality as before with
significantly fewer lines of code. If you want, you can run the server
and go to the admin panel / graphql endpoints to verify things are
working as you expect.</p>
<p>Sorry if feel that you went through all that trouble in part 1 for nothing.
At least now you know what&#8217;s going on underneath and hopefully you never have
to write that much boilerplate again. If you do need to implement a
completely custom service, send me a message and let&#8217;s work together to figure
out if nautilus can better serve your needs at a framework level.</p>
</div>
<div class="section" id="connection-models">
<h2>Connection Models<a class="headerlink" href="#connection-models" title="Permalink to this headline">¶</a></h2>
<p>Another very common service in nautilus clouds is the ConnectionService which
is a specialized ModelService whose internal data represents the relationship
between two other services. If you are familiar with databases, connection
services play the exact same role as join tables.</p>
<p>If that made sense to you, feel free to skip this paragraph. To illustrate
the role of connection services, say there is an entry in the recipe table
with and id of 1 and a entry in the ingredient table which also has an id
of 1. To express that the recipe contains a particular ingredient, we would
add an entry in the connection service which has a value of 1 in the recipe
column and a value of 1 in the ingredient column. Keep in mind that these
columns do not necessarily have to be unique. If there was a second ingredient
with id 2 that is also a part of the recipe, there would be a second entry in
the connection service that has a 1 in the recipe column but this time there
would be a 2 in the ingredient column. This relationship is called
&#8220;many-to-many&#8221; because a recipe can have many ingredients and an ingredient can be a member of many recipes (neither column is unique). Relationships can also be
classified as &#8220;one-to-one&#8221; and &#8220;one-to-many&#8221;.</p>
<p>Make a new file called <code class="docutils literal"><span class="pre">recipeIngredients.py</span></code> next to the previously created
files. Now, create a ConnectionService to manage the relationship between
recipes and ingredients:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># external imports</span>
<span class="kn">from</span> <span class="nn">nautilus</span> <span class="kn">import</span> <span class="n">ConnectionService</span>
<span class="c1"># local imports</span>
<span class="kn">from</span> <span class="nn">recipes</span> <span class="kn">import</span> <span class="n">service</span> <span class="k">as</span> <span class="n">recipeService</span>
<span class="kn">from</span> <span class="nn">ingredients</span> <span class="kn">import</span> <span class="n">service</span> <span class="n">ingredientService</span>

<span class="k">class</span> <span class="nc">ServiceConfig</span><span class="p">:</span>
    <span class="n">SQLALCHEMY_DATABASE_URI</span> <span class="o">=</span> <span class="s1">&#39;sqlite:////tmp/ingredients.db&#39;</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">ConnectionService</span><span class="p">(</span>
    <span class="n">services</span> <span class="o">=</span> <span class="p">[</span><span class="n">recipeService</span><span class="p">,</span> <span class="n">ingredientService</span><span class="p">],</span>
    <span class="n">configObject</span> <span class="o">=</span> <span class="n">ServiceConfig</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Again, you can run the service and check out the various endpoints.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="Querying The Distributed Structure" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="first_service.html" class="btn btn-neutral" title="Your First Service" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Alec Aivazis.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'v0.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>